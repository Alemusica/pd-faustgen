language: c
dist: trusty
sudo: required

notifications:
  email: false
git:
  submodules: true

matrix:
  include:
  - os: osx
    compiler: clang
    env: plateform='macos'
    install:
      - git submodule update --init --recursive
      - curl -o ./llvm.tar.gz http://releases.llvm.org/5.0.0/clang+llvm-5.0.0-x86_64-apple-darwin.tar.xz
      - tar zxvf ./llvm.tar.gz && mv clang+llvm-5.0.0-x86_64-apple-darwin llvm
    script:
      - export PATH=$PATH:="./llvm"
      - export PATH=$PATH:="./llvm/bin"
      - export CXXFLAGS="-I./llvm/include"
      - mkdir faust/build/forpd && cd faust/build/forpd
      - cmake .. -DINCLUDE_STATIC=on -DINCLUDE_OSC=off -DINCLUDE_HTTP=off -DUNIVERSAL=on -DUSE_LLVM_CONFIG=off -DLLVM_DIR=./../../llvm/lib/cmake/llvm -DCMAKE_OSX_DEPLOYMENT_TARGET=10.9 -C../backends/backends.cmake
      - make --quiet
      - mkdir ../../../build && cd ../../../build
      - cmake .. -GXcode "-DCMAKE_OSX_ARCHITECTURES=i386;x86_64" -DLLVM_DIR=./llvm/lib/cmake/llvm
      - cmake --build . --config Release
      - cmake --build . --config Release
  - os: linux
    compiler: gcc
    env: plateform='linux32'
    install:
      - git submodule update --init --recursive
      - sudo apt-get install -y gcc-multilib libc6-dev-i386 pkg-config libedit-dev
    script:
      - mkdir faust/build/forpd && cd faust/build/forpd
      - cmake .. -DINCLUDE_STATIC=on -DINCLUDE_OSC=off -DINCLUDE_HTTP=off -DCMAKE_C_FLAGS=-m32 -C../backends/backends.cmake
      - make --quiet
      - mkdir ../../../build && cd ../../../build
      - cmake .. -DCMAKE_C_FLAGS=-m32
      - cmake --build . --config Release
  - os: linux
    compiler: gcc
    env: plateform='linux64'
    install:
      - git submodule update --init --recursive
      - sudo apt-get install -y pkg-config libedit-dev
    script:
      - mkdir faust/build/forpd && cd faust/build/forpd
      - cmake .. -DINCLUDE_STATIC=on -DINCLUDE_OSC=off -DINCLUDE_HTTP=off -DCMAKE_C_FLAGS=-m64 -C../backends/backends.cmake
      - make --quiet
      - mkdir ../../../build && cd ../../../build
      - cmake .. -DCMAKE_C_FLAGS=-m64
      - cmake --build . --config Release
